<app-header titleLn1="PDR" titleLn2="Request Form"></app-header>

<main class="app-container">
  <!-- Welcome Hero Section (Collapsible) -->
  <section class="welcome-hero" *ngIf="!isLoading && !datasetNotFound" [class.collapsed]="isWelcomeCollapsed">
    <div class="welcome-header" (click)="toggleWelcome()">
      <div class="welcome-header-spacer"></div>
      <h1 class="welcome-title">Request Access to Restricted Data</h1>
      <button class="collapse-btn" type="button" [attr.aria-expanded]="!isWelcomeCollapsed">
        <mat-icon>{{ isWelcomeCollapsed ? 'expand_more' : 'expand_less' }}</mat-icon>
      </button>
    </div>
    <div class="welcome-content" [@collapseAnimation]="isWelcomeCollapsed ? 'collapsed' : 'expanded'">
      <p class="welcome-description">
        Welcome to the NIST Public Data Repository access request portal. Complete the form below
        to request access to restricted datasets. Your request will be reviewed by our data stewards
        and you'll receive a response by email.
      </p>

<!--
      <div class="welcome-features">
        <div class="feature-item">
          <mat-icon>schedule</mat-icon>
          <span>Quick Review Process</span>
        </div>
        <div class="feature-item">
          <mat-icon>security</mat-icon>
          <span>Secure & Confidential</span>
        </div>
        <div class="feature-item">
          <mat-icon>support_agent</mat-icon>
          <span>Dedicated Support</span>
        </div>
      </div>
  -->

    </div>
  </section>

  <!-- Form Card -->
  <div class="form-card">
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p class="loading-text">Loading your request form...</p>
    </div>

    <!-- Dataset Not Found State -->
    <div *ngIf="datasetNotFound && !isLoading" class="error-container">
      <mat-icon class="error-icon">search_off</mat-icon>
      <h2 class="error-title">Dataset Not Found</h2>
      <p class="error-message">
        We couldn't find the dataset you're looking for. Please verify the URL and try again.
      </p>
      <a href="https://data.nist.gov" class="retry-btn" mat-raised-button color="primary">
        Browse Datasets
      </a>
    </div>

    <!-- Main Content -->
    <div *ngIf="formConfig && selectedDataset && !isLoading && !datasetNotFound" class="card-content">
      <!-- Dataset Info -->
      <div class="dataset-info">
        <div class="dataset-header">
          <div class="dataset-icon">
            <mat-icon>storage</mat-icon>
          </div>
          <div class="dataset-details">
            <h2 class="dataset-name">{{ selectedDataset.name }}</h2>
            <div class="dataset-id-row">
              <span class="dataset-id">{{ selectedDataset.id }}</span>
              <button class="copy-btn" (click)="copyToClipboard(selectedDataset.id)" title="Copy ID">
                <mat-icon>content_copy</mat-icon>
              </button>
            </div>
          </div>
        </div>
      </div>
      <a *ngIf="selectedDataset.url" [href]="selectedDataset.url" target="_blank" class="dataset-link-btn">
        <span>Visit Dataset Page</span>
        <mat-icon>open_in_new</mat-icon>
      </a>

      <!-- Dynamic Form -->
      <app-dynamic-form
        #dynamicForm
        [formConfig]="formConfig"
        [dataset]="selectedDataset"
        [countryOptions]="countryOptions"
        (formSubmit)="onFormSubmit($event)"
      ></app-dynamic-form>
    </div>
  </div>

  <!-- Footer Note -->
  <footer class="page-footer" *ngIf="!isLoading && !datasetNotFound">
    <p class="footer-text">
      Need help? Contact <a href="mailto:datasupport@nist.gov">datasupport&#64;nist.gov</a>
    </p>
  </footer>
</main>

<app-footer></app-footer>

<!-- Dark Mode FAB -->
<button class="dark-mode-fab" (click)="toggleDarkMode()" [attr.aria-label]="isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'">
  <mat-icon>{{ isDarkMode ? 'light_mode' : 'dark_mode' }}</mat-icon>
</button>

<!-- Copy Toast Notification -->
<div class="copy-toast" [class.visible]="showCopyToast">
  <mat-icon>check_circle</mat-icon>
  <span>ID copied to clipboard</span>
</div>
